<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Module ppool_db</title>
<link rel="stylesheet" type="text/css" href="stylesheet.css" title="EDoc">
</head>
<body bgcolor="white">
<div class="navbar"><a name="#navbar_top"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<hr>

<h1>Module ppool_db</h1>
<ul class="index"><li><a href="#description">Description</a></li><li><a href="#index">Function Index</a></li><li><a href="#functions">Function Details</a></li></ul>  
Database query methods for working with the postgress pool.
<p>Copyright Â© 2024 Matthew Tolman</p>

<p><b>Version:</b> 0.1.1</p>
<p><b>Authors:</b> Matthwe Tolman.</p>

<h2><a name="description">Description</a></h2><p>  
Database query methods for working with the postgress pool.</p>
 
  <p>Query methods can take an optional pool for when there are multiple database pools (e.g. app is connected to multiple databases).
  If no pool is provided, then the default pool will be picked (see <a docgen-rel="seemfa" docgen-href="ppool_defaults#default_pool/0" href="ppool_defaults.html#default_pool-0"><code>ppool_defaults:default_pool/0</code></a>).</p>
 
  Additionally, some queries will need a key column. If no key column is provided, one will be generated by doing inflection from
  plural to singular (see <a docgen-rel="seemfa" docgen-href="ppool_defaults#use_inflection/0" href="ppool_defaults.html#use_inflection-0"><code>ppool_defaults:use_inflection/0</code></a> and <a docgen-rel="seemfa" docgen-href="ppool_defaults#inflection_method/0" href="ppool_defaults.html#inflection_method-0"><code>ppool_defaults:inflection_method/0</code></a>) followed by adding
  an id suffix (see <a docgen-rel="seemfa" docgen-href="ppool_defaults#default_id_suffix/0" href="ppool_defaults.html#default_id_suffix-0"><code>ppool_defaults:default_id_suffix/0</code></a>).
<h2><a name="index">Function Index</a></h2>
<table width="100%" border="1" cellspacing="0" cellpadding="2" summary="function index"><tr><td valign="top"><a href="#delete-2">delete/2</a></td><td>
  Removes a record from a table by ID from the default pool.</td></tr>
<tr><td valign="top"><a href="#delete-3">delete/3</a></td><td>
  Removes a record from a table by ID from the default pool.</td></tr>
<tr><td valign="top"><a href="#delete-4">delete/4</a></td><td>
  Removes a record from a table by ID from the specified pool.</td></tr>
<tr><td valign="top"><a href="#get_all-1">get_all/1</a></td><td>Gets all values from a table up to the default limit of 1000 items.</td></tr>
<tr><td valign="top"><a href="#get_all-2">get_all/2</a></td><td>Gets all values from a table with the default pool using the specified options.</td></tr>
<tr><td valign="top"><a href="#get_by_id-2">get_by_id/2</a></td><td>
  Gets an element from a table by id using the default pool.</td></tr>
<tr><td valign="top"><a href="#get_by_id-3">get_by_id/3</a></td><td>
  Gets an element from a table by id using the default pool.</td></tr>
<tr><td valign="top"><a href="#get_by_id-4">get_by_id/4</a></td><td>
  Gets an element from a table by id using the specified pool.</td></tr>
<tr><td valign="top"><a href="#get_id_col-1">get_id_col/1</a></td><td>
  Gets the key/id column from a table name.</td></tr>
<tr><td valign="top"><a href="#insert-2">insert/2</a></td><td>
  Inserts a map into a table on the default pool.</td></tr>
<tr><td valign="top"><a href="#insert-3">insert/3</a></td><td>
  Inserts a map into a table on the specified pool.</td></tr>
<tr><td valign="top"><a href="#query-1">query/1</a></td><td>Runs an SQL query against the default pool and returns the result.</td></tr>
<tr><td valign="top"><a href="#query-2">query/2</a></td><td>  
If the first term is an atom, then it will treat the second param as an SQL query and it will run the SQL query against a specific pool.</td></tr>
<tr><td valign="top"><a href="#query-3">query/3</a></td><td>Runs a query with prepared data against a specific pool.</td></tr>
<tr><td valign="top"><a href="#save-2">save/2</a></td><td>Saves a map to the database on the default pool.</td></tr>
<tr><td valign="top"><a href="#save-3">save/3</a></td><td>Saves a map to the database on the default pool.</td></tr>
<tr><td valign="top"><a href="#update-2">update/2</a></td><td>
  Updates an item in a table on the default pool.</td></tr>
<tr><td valign="top"><a href="#update-3">update/3</a></td><td>
  Updates an item in a table on the default pool.</td></tr>
<tr><td valign="top"><a href="#update-4">update/4</a></td><td>
  Updates an item in a table on the specified pool.</td></tr>
</table>

<h2><a name="functions">Function Details</a></h2>

<h3 class="function"><a name="delete-2">delete/2</a></h3>
<div class="spec">
<p><code>delete(Table::atom() | string() | binary(), KeyVal::term()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Removes a record from a table by ID from the default pool. Will auto generate the ID column name from the table if not provided.</p>

<h3 class="function"><a name="delete-3">delete/3</a></h3>
<div class="spec">
<p><code>delete(Table::atom() | string() | binary(), KeyCol::atom() | string() | binary(), KeyVal::term()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Removes a record from a table by ID from the default pool.</p>

<h3 class="function"><a name="delete-4">delete/4</a></h3>
<div class="spec">
<p><code>delete(Pool::atom(), Table::atom() | string() | binary(), KeyCol::atom() | string() | binary(), KeyVal::term()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Removes a record from a table by ID from the specified pool.</p>

<h3 class="function"><a name="get_all-1">get_all/1</a></h3>
<div class="spec">
<p><code>get_all(Table::atom() | string() | binary()) -&gt; {ok, [map()]} | {error, term()}</code><br></p>
<p> </p>
</div><p>Gets all values from a table up to the default limit of 1000 items.</p>

<h3 class="function"><a name="get_all-2">get_all/2</a></h3>
<div class="spec">
<p><code>get_all(Table::atom() | string() | binary(), Opts::map() | [{limit | offset | order_by | order_dir, term()}]) -&gt; {ok, [map()]} | {error, term()}</code><br></p>
<p> </p>
</div><p><p>Gets all values from a table with the default pool using the specified options.</p>
 
  <p>Options may be a map or proplist. Possible options:</p>
 
  - **limit** - The maximum number of elements to return (default 1000)
  - **offset** - Result offset (default 0)
  - **order_by** - The column to order results by
  - **order_dir** - The direction to order in ("asc" or "desc"). Default is "asc"</p>

<h3 class="function"><a name="get_by_id-2">get_by_id/2</a></h3>
<div class="spec">
<p><code>get_by_id(Table::atom() | string() | binary(), ID::term()) -&gt; {ok, term()} | {error, not_found} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Gets an element from a table by id using the default pool.
  The key column used for the where clause is generated from the table name.</p>

<h3 class="function"><a name="get_by_id-3">get_by_id/3</a></h3>
<div class="spec">
<p><code>get_by_id(Table::atom() | string() | binary(), KeyCol::string() | atom() | binary(), ID::term()) -&gt; {ok, term()} | {error, not_found} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Gets an element from a table by id using the default pool.</p>

<h3 class="function"><a name="get_by_id-4">get_by_id/4</a></h3>
<div class="spec">
<p><code>get_by_id(Pool::atom(), Table::atom() | string() | binary(), KeyCol::string() | atom() | binary(), ID::term()) -&gt; {ok, term()} | {error, not_found} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Gets an element from a table by id using the specified pool.</p>

<h3 class="function"><a name="get_id_col-1">get_id_col/1</a></h3>
<div class="spec">
<p><code>get_id_col(Table::atom() | string() | binary()) -&gt; binary()</code><br></p>
<p> </p>
</div><p>
  Gets the key/id column from a table name.
  Exposed publicly to assist in debugging and schema validation.</p>

<h3 class="function"><a name="insert-2">insert/2</a></h3>
<div class="spec">
<p><code>insert(Table::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Inserts a map into a table on the default pool</p>

<h3 class="function"><a name="insert-3">insert/3</a></h3>
<div class="spec">
<p><code>insert(Pool::atom(), Table::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Inserts a map into a table on the specified pool</p>

<h3 class="function"><a name="query-1">query/1</a></h3>
<div class="spec">
<p><code>query(Sql::string() | binary()) -&gt; {ok, [map()] | term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>Runs an SQL query against the default pool and returns the result.</p>

<h3 class="function"><a name="query-2">query/2</a></h3>
<div class="spec">
<p><code>query(Pool::atom(), Sql::string() | binary()) -&gt; {ok, [map()] | term()} | {error, term()}</code><br></p><p><code>query(Pool::string() | binary(), Sql::[term()]) -&gt; {ok, [map()] | term()} | {error, term()}</code><br></p>
<p> </p>
<p> </p>
</div><p><p>  
If the first term is an atom, then it will treat the second param as an SQL query and it will run the SQL query against a specific pool.</p>
 
  If the first term is a string/binary, then it will treat the second param as a list of prepared data values and it will run the query
  against the default pool with the prepared values.</p>

<h3 class="function"><a name="query-3">query/3</a></h3>
<div class="spec">
<p><code>query(Pool::atom(), Sql::string() | binary(), Params::[term()]) -&gt; {ok, [map()] | term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>Runs a query with prepared data against a specific pool.</p>

<h3 class="function"><a name="save-2">save/2</a></h3>
<div class="spec">
<p><code>save(Table::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>Saves a map to the database on the default pool.
  Will select the key column based on the table name.
  If the key column is missing from the map or it is undefined or 0 then an insert is done.
  Otherwise, an update will be done</p>

<h3 class="function"><a name="save-3">save/3</a></h3>
<div class="spec">
<p><code>save(Table::atom() | string() | binary(), Key::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, term()}</code><br></p>
<p> </p>
</div><p>Saves a map to the database on the default pool.
  If the key column is missing from the map or it is undefined or 0 then an insert is done.
  Otherwise, an update will be done</p>

<h3 class="function"><a name="update-2">update/2</a></h3>
<div class="spec">
<p><code>update(Table::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, missing_key_field} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Updates an item in a table on the default pool.
  Will select the key column based on the table name.
  The key column must be present in the map.</p>

<h3 class="function"><a name="update-3">update/3</a></h3>
<div class="spec">
<p><code>update(Table::atom() | string() | binary(), KeyCol::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, missing_key_field} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Updates an item in a table on the default pool.
  The key column must be present in the map.</p>

<h3 class="function"><a name="update-4">update/4</a></h3>
<div class="spec">
<p><code>update(Pool::atom(), Table::atom() | string() | binary(), KeyCol::atom() | string() | binary(), Item::map()) -&gt; {ok, term()} | {error, missing_key_field} | {error, term()}</code><br></p>
<p> </p>
</div><p>
  Updates an item in a table on the specified pool.
  The key column must be present in the map.</p>
<hr>

<div class="navbar"><a name="#navbar_bottom"></a><table width="100%" border="0" cellspacing="0" cellpadding="2" summary="navigation bar"><tr><td><a href="overview-summary.html" target="overviewFrame">Overview</a></td><td><a href="http://www.erlang.org/"><img src="erlang.png" align="right" border="0" alt="erlang logo"></a></td></tr></table></div>
<p><i>Generated by EDoc</i></p>
</body>
</html>
